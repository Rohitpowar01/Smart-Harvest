<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Smart Harvest - Customer</title>
  <link rel="icon" type="image/png" href="/assets/img/logo.png" />

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    crossorigin="anonymous">
  <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css"
    crossorigin="anonymous"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-social/5.1.1/bootstrap-social.min.css"/>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet">
  <link href="/assets/css/nucleo-icons.css" rel="stylesheet" />
  <link href="/assets/css/nucleo-svg.css" rel="stylesheet" />
  <link rel="stylesheet" href="/assets/css/creativetim.min.css" type="text/css">
</head>

<body class="bg-white" id="top">
  <%- include('../partials/navbar')  %>
  <section class="section section-shaped section-lg">
    <div class="shape shape-style-1 shape-primary">
      <% for (let i = 0; i < 10; i++) { %><span></span><% } %>
    </div>

    <div class="container mt-5">
      <div class="row">
        <!-- Profile Image Card -->
        <div class="col-md-4">
          <div class="card bg-warning text-center">
            <div class="card-body">
              <img src="/assets/img/customers.png" class="rounded-circle" width="150" />
              <h4>Welcome <%= customer.cust_name %></h4>
              <button class="btn btn-danger" data-toggle="modal" data-target="#editProfile">Edit Profile</button>
            </div>
          </div>
        </div>

        <!-- Profile Info Card -->
        <div class="col-md-8">
          <div class="card bg-success text-white">
            <div class="card-body">
              <p><strong>Customer ID:</strong> <%= customer.cust_id %></p>
              <p><strong>Name:</strong> <%= customer.cust_name %></p>
              <p><strong>Email:</strong> <%= customer.email %></p>
              <p><strong>Mobile:</strong> <%= customer.phone_no %></p>
              <p><strong>State:</strong> <%= customer.state %></p>
              <p><strong>District:</strong> <%= customer.district %></p>
              <p><strong>Address:</strong> <%= customer.address %></p>
              <p><strong>Pincode:</strong> <%= customer.pincode %></p>
              <p><strong>Password:</strong> ********</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Edit Profile Modal -->
    <div class="modal fade" id="editProfile" tabindex="-1" role="dialog">
      <div class="modal-dialog modal-lg">
        <div class="modal-content bg-gradient-danger text-white">
          <div class="modal-header">
            <h5 class="modal-title">Edit Profile</h5>
            <button type="button" class="close text-white" data-dismiss="modal">&times;</button>
          </div>

          <form method="POST" action="/customer/update-profile">
            <div class="modal-body">
              <input type="hidden" name="id" value="<%= customer.cust_id %>">

              <div class="form-group">
                <label>Name</label>
                <input type="text" name="name" value="<%= customer.cust_name %>" class="form-control">
              </div>

              <div class="form-group">
                <label>Email</label>
                <input type="email" value="<%= customer.email %>" class="form-control" readonly>
              </div>

              <div class="form-group">
                <label>Mobile</label>
                <input type="text" name="mobile" value="<%= customer.phone_no %>" class="form-control">
              </div>

              <div class="form-group">
                <label>State</label>
                <select name="state" id="state" class="form-control" onchange="getDistricts(this.value)">
                  <option value="<%= customer.state %>"><%= customer.state %></option>
                  <% states.forEach(state => { %>
                    <option value="<%= state.StCode %>"><%= state.StateName %></option>
                  <% }) %>
                </select>
              </div>

              <div class="form-group">
                <label>District</label>
                <select name="district" id="district-list" class="form-control">
                  <option value="<%= customer.district %>"><%= customer.district %></option>
                </select>
              </div>

              <div class="form-group">
                <label>Address</label>
                <input type="text" name="address" value="<%= customer.address %>" class="form-control">
              </div>

              <div class="form-group">
                <label>Pincode</label>
                <input type="text" name="pincode" value="<%= customer.pincode %>" class="form-control">
              </div>

              <div class="form-group">
                <label>Password</label>
                <input type="password" name="pass" value="<%= customer.password %>" class="form-control" id="password">
              </div>
            </div>

            <div class="modal-footer">
              <button class="btn btn-success btn-block" type="submit">Update</button>
            </div>
          </form>
        </div>
      </div>
    </div>

  </section>

  <!-- JS Scripts -->
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  <script>
    function getDistricts(stateId) {
      $.post('/customer/get-district', { state_id: stateId }, function (data) {
        $('#district-list').html(data);
      });
    }
  </script>
</body>
</html>
